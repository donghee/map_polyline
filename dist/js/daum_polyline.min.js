function vertexImage(a,e){return new daum.maps.MarkerImage(a,new daum.maps.Size(2*e,2*e),{offset:new daum.maps.Point(e,e)})}function createMarker(a,e,t,p){return new Marker({map:a,position:e,draggable:t,image:p})}var Map=function(a,e,t,p){var r=document.getElementById(a),m={center:new daum.maps.LatLng(e,t),level:p};daum.maps.Map.call(this,r,m)};Map.prototype=Object.create(daum.maps.Map.prototype),Map.prototype.constructor=Map;var Event=daum.maps.event,Marker=daum.maps.Marker;daum.maps.Marker.prototype.setIcon=daum.maps.Marker.prototype.setImage;var LatLng=daum.maps.LatLng;daum.maps.LatLng.prototype.lat=daum.maps.LatLng.prototype.getLat,daum.maps.LatLng.prototype.lng=daum.maps.LatLng.prototype.getLng;var Polyline=function(a){daum.maps.Polyline.call(this,a),this.markers=[],this.middle_markers=[]};Polyline.prototype=Object.create(daum.maps.Polyline.prototype),Polyline.prototype.constructor=Polyline;
Array.prototype.getAt=function(t){return this[t]},Array.prototype.setAt=function(t,e){this[t]=e},Array.prototype.insertAt=function(t,e){this.splice(t,0,e)},Array.prototype.deleteE=function(t){return this.filter(function(e){return t!=e})},Polyline.prototype.setAt=function(t,e){var r=this.getPath();r.setAt(t,e),this.setPath(r)},Polyline.prototype.getAt=function(t){return this.getPath().getAt(t)},Polyline.prototype.addVertex=function(){if(0==this.getPath().length){var t=this.getMap().getCenter();this.append(t)}else{var e=this.getPath(),r=e.getAt(e.length-1),i=new LatLng(r.lat()+.002,r.lng()+.002);this.append(i)}},Polyline.prototype.clear=function(){var t=[];this.setPath(t);for(e=0;e<this.markers.length;e++)this.markers[e].setMap(null);this.markers=[];for(var e=0;e<this.middle_markers.length;e++)this.middle_markers[e].setMap(null);this.middle_markers=[]},Polyline.prototype.append=function(t){var e=this.getPath().length;this.insertMiddle(e,t)},Polyline.prototype.insertMiddle=function(t,e){var r=this.getPath();r.insertAt(t,e),this.setPath(r);var i=this.newMarker(e,t);this.markers.insertAt(t,i);for(g=t+1;g<r.length;g++){var n=vertexImage(vertexImgURL(g+1),16);this.markers[g].setIcon(n)}if(t>0){var s=r.getAt(t-1),a=new LatLng((s.lat()+e.lat())/2,(s.lng()+e.lng())/2),l=this.newMiddle(a,t-1);this.middle_markers.insertAt(t-1,l)}if(t+1<r.length){var s=r.getAt(t+1),o=new LatLng((s.lat()+e.lat())/2,(s.lng()+e.lng())/2),h=this.newMiddle(o,t);this.middle_markers.insertAt(t+1,h)}for(var d=-1,g=0;g<this.middle_markers.length;g++){var m=(p=this.middle_markers[g]).getPosition();if(m.lat()===e.lat()&&m.lng()===e.lng()){d=g;break}}if(d>0){var p=this.middle_markers[d];this.middle_markers=this.middle_markers.deleteE(p),p.setMap(null)}},Polyline.prototype.newMarker=function(t,e){var r=createMarker(this.getMap(),t,!0,vertexImage(vertexImgURL(e+1),16));return Event.addListener(r,"click",function(){if("function"==typeof clickVertex)return clickVertex(r);console.error("function clickVertex(vertex) { } is not implemented")}.bind(this)),Event.addListener(r,"dragend",function(){return this.moveVertex(r)}.bind(this)),r},Polyline.prototype.newMiddle=function(t,e){var r=createMarker(this.getMap(),t,!1,vertexImage(middleImgURL(),8));return Event.addListener(r,"click",function(){var t=this.middle_markers.indexOf(r);this.insertMiddle(t+1,r.getPosition())}.bind(this)),r},Polyline.prototype.moveVertex=function(t){var e=t.getPosition(),r=this.markers.indexOf(t);if(this.setAt(r,e),r>0){var i=this.middle_markers[r-1],n=this.getPath().getAt(r-1),s=new LatLng((n.lat()+e.lat())/2,(n.lng()+e.lng())/2);i.setPosition(s)}if(r<this.markers.length-1){var a=this.middle_markers[r],n=this.getPath().getAt(r+1),s=new LatLng((n.lat()+e.lat())/2,(n.lng()+e.lng())/2);a.setPosition(s)}};