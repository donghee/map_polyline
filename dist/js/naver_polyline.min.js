function vertexImage(e,a){return{url:e,size:new naver.maps.Size(2*a,2*a),origin:new naver.maps.Point(0,0),anchor:new naver.maps.Point(a,a)}}function createMarker(e,a,r,n){return new Marker({map:e,position:a,draggable:r,icon:n})}var Map=function(e,a,r,n){var t={center:new naver.maps.LatLng(a,r),zoom:n};naver.maps.Map.call(this,e,t)};Map.prototype=Object.create(naver.maps.Map.prototype),Map.prototype.constructor=Map;var Event=naver.maps.Event,Marker=naver.maps.Marker,LatLng=naver.maps.LatLng,Polyline=function(e){naver.maps.Polyline.call(this,e),this.markers=[],this.middle_markers=[]};Polyline.prototype=Object.create(naver.maps.Polyline.prototype),Polyline.prototype.constructor=Polyline;
Array.prototype.getAt=function(t){return this[t]},Array.prototype.setAt=function(t,e){this[t]=e},Array.prototype.insertAt=function(t,e){this.splice(t,0,e)},Array.prototype.deleteE=function(t){return this.filter(function(e){return t!=e})},Polyline.prototype.setAt=function(t,e){var i=this.getPath();i.setAt(t,e),this.setPath(i)},Polyline.prototype.getAt=function(t){return this.getPath().getAt(t)},Polyline.prototype.addVertex=function(){if(0==this.getPath().length){var t=this.getMap().getCenter();this.append(t)}else{var e=this.getPath(),i=e.getAt(e.length-1),r=new LatLng(i.lat()+.002,i.lng()+.002);this.append(r)}},Polyline.prototype.clear=function(){var t=[];this.setPath(t);for(e=0;e<this.markers.length;e++)this.markers[e].setMap(null);this.markers=[];for(var e=0;e<this.middle_markers.length;e++)this.middle_markers[e].setMap(null);this.middle_markers=[]},Polyline.prototype.append=function(t){var e=this.getPath().length;this.insertMiddle(e,t)},Polyline.prototype.insertMiddle=function(t,e){var i=this.getPath();i.insertAt(t,e),this.setPath(i);var r=this.newMarker(e,t);this.markers.insertAt(t,r);for(g=t+1;g<i.length;g++){var n=vertexImage(vertexImgURL(g+1),16);this.markers[g].setIcon(n)}if(t>0){var s=i.getAt(t-1),a=new LatLng((s.lat()+e.lat())/2,(s.lng()+e.lng())/2),l=this.newMiddle(a,t-1);this.middle_markers.insertAt(t-1,l)}if(t+1<i.length){var s=i.getAt(t+1),o=new LatLng((s.lat()+e.lat())/2,(s.lng()+e.lng())/2),h=this.newMiddle(o,t);this.middle_markers.insertAt(t+1,h)}for(var d=-1,g=0;g<this.middle_markers.length;g++){var m=(p=this.middle_markers[g]).getPosition();if(m.lat()===e.lat()&&m.lng()===e.lng()){d=g;break}}if(d>0){var p=this.middle_markers[d];this.middle_markers=this.middle_markers.deleteE(p),p.setMap(null)}},Polyline.prototype.newMarker=function(t,e){var i=createMarker(this.getMap(),t,!0,vertexImage(vertexImgURL(e+1),16));return Event.addListener(i,"click",function(){if("function"==typeof clickVertex)return clickVertex(i)}.bind(this)),Event.addListener(i,"dragend",function(){return this.moveVertex(i)}.bind(this)),i},Polyline.prototype.newMiddle=function(t,e){var i=createMarker(this.getMap(),t,!1,vertexImage(middleImgURL(),8));return Event.addListener(i,"click",function(){var t=this.middle_markers.indexOf(i);this.insertMiddle(t+1,i.getPosition())}.bind(this)),i},Polyline.prototype.moveVertex=function(t){var e=t.getPosition(),i=this.markers.indexOf(t);if(this.setAt(i,e),i>0){var r=this.middle_markers[i-1],n=this.getPath().getAt(i-1),s=new LatLng((n.lat()+e.lat())/2,(n.lng()+e.lng())/2);r.setPosition(s)}if(i<this.markers.length-1){var a=this.middle_markers[i],n=this.getPath().getAt(i+1),s=new LatLng((n.lat()+e.lat())/2,(n.lng()+e.lng())/2);a.setPosition(s)}};